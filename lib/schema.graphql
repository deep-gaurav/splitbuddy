union AuthResult = UserNotSignedUp | UserSignedUp

type Expense {
  id: String!
  title: String!
  createdAt: String!
  creator: User!
  group: Group!
  amount: Int!
  splits: [Split!]!
}

type Group {
  id: String!
  name: String
  createdAt: String!
  creator: User!
  members: [GroupMember!]!
  expenses(skip: Int! = 0, limit: Int! = 10): [Expense!]!
  owed: Int!
}

type GroupMember {
  member: User!
  owedInGroup: Int!
}

type Mutation {
  sendEmailOtp(email: String!): Boolean!
  verifyOtp(email: String!, otp: String!): AuthResult!
  refreshToken(refreshToken: String!): UserSignedUp!
  signup(name: String!, upiId: String): SignupSuccess!
  createGroup(name: String!): Group!
  addToGroupByEmail(groupId: String!, email: String!): String!
  addNonGroupExpense(
    title: String!
    amount: Int!
    splits: [SplitInputNonGroup!]!
  ): NonGroupExpense!
  addExpense(
    groupId: String!
    title: String!
    amount: Int!
    splits: [SplitInput!]!
  ): Expense!
  settleInGroup(toUser: String!, groupId: String!, amount: Int!): Split!
  simplifyCrossGroup(withUser: String!): [Split!]!
  autoSettleWithUser(withUser: String!, amount: Int!): [Split!]!
}

type NonGroupExpense {
  group: Group!
  expense: Expense!
}

type OwedInGroup {
  groupId: String!
  amount: Int!
}

type Query {
  ping: String!
  user: UserAuth!
  group(id: String!): Group!
  userById(id: String!): User!
  expensesWithUser(
    userId: String!
    skip: Int! = 0
    limit: Int! = 10
  ): [Expense!]!
  interactedUsers: [User!]!
  groups: [Group!]!
  findUserByEmail(email: String!): User!
  overallOwed: Int!
  getTransactionsWithUser(withUser: String!, skip: Int!, limit: Int!): [Split!]!
}

type Registered {
  user: User!
}

type SignupSuccess {
  user: User!
  tokens: UserSignedUp!
}

type Split {
  id: String!
  expense: Expense
  group: Group!
  amount: Int!
  fromUser: User!
  toUser: User!
  transactionType: TransactionType!
  createdAt: String!
  creator: User!
  transactionPartGroupId: String
}

input SplitInput {
  amount: Int!
  userId: String!
}

input SplitInputNonGroup {
  amount: Int!
  email: String
  userId: String
}

enum TransactionType {
  EXPENSE_SPLIT
  CROSS_GROUP_SETTLEMENT
  CASH_PAID
}

type Unregistered {
  phone: String
  email: String
}

type User {
  id: String!
  name: String
  phone: String
  email: String
  isSignedUp: Boolean!
  owes: [OwedInGroup!]!
  upiIds: [String!]!
}

union UserAuth = Unregistered | Registered

type UserNotSignedUp {
  signupToken: String!
}

type UserSignedUp {
  accessToken: String!
  refreshToken: String!
}
